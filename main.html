<HTML>
<BODY>
<canvas id="lab04" width="800" height="532" style="border:1px solid black;">
</canvas>
<canvas id="lab04_1" width="800" height="532" style="border:1px solid black;">
</canvas>
<script>
    var canvas = document.getElementById("lab04");
    var ctx = canvas.getContext("2d");

    var img = new Image;
    img.setAttribute( 'crossOrigin', 'Anonymous');
    img.onload = function() {
        ctx.drawImage(img, 0, 0);
        var idata = ctx.getImageData(0, 0, canvas.width, canvas.height);
        console.log(idata);

        var canvas1 = document.getElementById("lab04_1");
        var ctx1 = canvas1.getContext("2d");

        var h = canvas.height;
        var w = canvas.width;

        var idata1 = ctx1.createImageData(w, h);
        for (var i=1; i<h-1; i++) {
            for (var j=1; j<w-1; j++) {
                if (idata.data[(i*w+j)*4+3] != 0) {
                    idata1.data[(i*w+j)*4] = ((idata.data[((i-1)*w+(j-1))*4]*(-1))**2 + (idata.data[((i-1)*w+j)*4]*(-2))**2 + (idata.data[((i-1)*w+(j+1))*4]*(-1))**2 +
                        (idata.data[(i*w+(j-1))*4]*0)**2 + (idata.data[(i*w+j)*4]*0)**2 + (idata.data[(i*w+(j+1))*4]*0)**2 +
                        (idata.data[((i+1)*w+(j-1))*4]*1)**2 + (idata.data[((i+1)*w+j)*4]*2)**2 + (idata.data[((i+1)*w+(j+1))*4]*1)**2 +
                        (idata.data[((i-1)*w+(j-1))*4]*(-1))**2 + (idata.data[((i-1)*w+j)*4]*0)**2 + (idata.data[((i-1)*w+(j+1))*4]*1)**2 +
                        (idata.data[(i*w+(j-1))*4]*(-2))**2 + (idata.data[(i*w+j)*4]*0)**2 + (idata.data[(i*w+(j+1))*4]*2)**2 +
                        (idata.data[((i+1)*w+(j-1))*4]*(-1))**2 + (idata.data[((i+1)*w+j)*4]*0)**2 + (idata.data[((i+1)*w+(j+1))*4]*1)**2) ** 0.5;

                    idata1.data[(i*w+j)*4+1] = ((idata.data[((i-1)*w+(j-1))*4+1]*(-1))**2 + (idata.data[((i-1)*w+j)*4+1]*(-2))**2 + (idata.data[((i-1)*w+(j+1))*4+1]*(-1))**2 +
                        (idata.data[(i*w+(j-1))*4+1]*0)**2 + (idata.data[(i*w+j)*4+1]*0)**2 + (idata.data[(i*w+(j+1))*4+1]*0)**2 +
                        (idata.data[((i+1)*w+(j-1))*4+1]*1)**2 + (idata.data[((i+1)*w+j)*4+1]*2)**2 + (idata.data[((i+1)*w+(j+1))*4+1]*1)**2 +
                        (idata.data[((i-1)*w+(j-1))*4+1]*(-1))**2 + (idata.data[((i-1)*w+j)*4+1]*0)**2 + (idata.data[((i-1)*w+(j+1))*4+1]*1)**2 +
                        (idata.data[(i*w+(j-1))*4+1]*(-2))**2 + (idata.data[(i*w+j)*4+1]*0)**2 + (idata.data[(i*w+(j+1))*4+1]*2)**2 +
                        (idata.data[((i+1)*w+(j-1))*4+1]*(-1))**2 + (idata.data[((i+1)*w+j)*4+1]*0)**2 + (idata.data[((i+1)*w+(j+1))*4+1]*1)**2) ** 0.5;

                    idata1.data[(i*w+j)*4+2] = ((idata.data[((i-1)*w+(j-1))*4+2]*(-1))**2 + (idata.data[((i-1)*w+j)*4+2]*(-2))**2 + (idata.data[((i-1)*w+(j+1))*4+2]*(-1))**2 +
                        (idata.data[(i*w+(j-1))*4+2]*0)**2 + (idata.data[(i*w+j)*4+2]*0)**2 + (idata.data[(i*w+(j+1))*4+2]*0)**2 +
                        (idata.data[((i+1)*w+(j-1))*4+2]*1)**2 + (idata.data[((i+1)*w+j)*4+2]*2)**2 + (idata.data[((i+1)*w+(j+1))*4+2]*1)**2 +
                        (idata.data[((i-1)*w+(j-1))*4+2]*(-1))**2 + (idata.data[((i-1)*w+j)*4+2]*0)**2 + (idata.data[((i-1)*w+(j+1))*4+2]*1)**2 +
                        (idata.data[(i*w+(j-1))*4+2]*(-2))**2 + (idata.data[(i*w+j)*4+2]*0)**2 + (idata.data[(i*w+(j+1))*4+2]*2)**2 +
                        (idata.data[((i+1)*w+(j-1))*4+2]*(-1))**2 + (idata.data[((i+1)*w+j)*4+2]*0)**2 + (idata.data[((i+1)*w+(j+1))*4+2]*1)**2) ** 0.5;

                    idata1.data[(i*w+j)*4+3] = ((idata.data[((i-1)*w+(j-1))*4+3]*(-1))**2 + (idata.data[((i-1)*w+j)*4+3]*(-2))**2 + (idata.data[((i-1)*w+(j+1))*4+3]*(-1))**2 +
                        (idata.data[(i*w+(j-1))*4+3]*0)**2 + (idata.data[(i*w+j)*4+3]*0)**2 + (idata.data[(i*w+(j+1))*4+3]*0)**2 +
                        (idata.data[((i+1)*w+(j-1))*4+3]*1)**2 + (idata.data[((i+1)*w+j)*4+3]*2)**2 + (idata.data[((i+1)*w+(j+1))*4+3]*1)**2 +
                        (idata.data[((i-1)*w+(j-1))*4+3]*(-1))**2 + (idata.data[((i-1)*w+j)*4+3]*0)**2 + (idata.data[((i-1)*w+(j+1))*4+3]*1)**2 +
                        (idata.data[(i*w+(j-1))*4+3]*(-2))**2 + (idata.data[(i*w+j)*4+3]*0)**2 + (idata.data[(i*w+(j+1))*4+3]*2)**2 +
                        (idata.data[((i+1)*w+(j-1))*4+3]*(-1))**2 + (idata.data[((i+1)*w+j)*4+3]*0)**2 + (idata.data[((i+1)*w+(j+1))*4+3]*1)**2) ** 0.5;
                }
            }
        }
        ctx1.putImageData(idata1, 0, 0);
    };
    img.src = "https://bigpicture.ru/wp-content/uploads/2015/11/nophotoshop29-800x532.jpg";
</script>
</BODY>
</HTML>
